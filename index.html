<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Truck Load Planner</title>
<link rel="stylesheet" href="css/style.css">
<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/"
  }
}
</script>
<!-- jspreadsheet-ce v4 + jsuites dependency -->
<script src="https://cdn.jsdelivr.net/npm/jspreadsheet-ce@4/dist/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsuites/dist/jsuites.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jspreadsheet-ce@4/dist/jspreadsheet.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsuites/dist/jsuites.min.css" />
</head>
<body>
<div id="app">
  <!-- Header -->
  <div id="header">
    <h1><span>Truck</span> Load Planner</h1>
    <div class="toolbar">
      <label>Truck:</label>
      <select id="truck-select"></select>
      <label>Config:</label>
      <select id="block-select"></select>
      <label>Sheet:</label>
      <input type="text" id="sheet-url" placeholder="Google Sheet URL or ID">
      <button id="btn-fetch-sheet">Fetch to Editor</button>
      <button id="btn-editor" title="Toggle editor mode â€” drag, rotate, reposition cases">Editor</button>
      <button id="btn-layout-mode" title="Toggle layout: stacked / side by side">&#9638; Stacked</button>
      <button id="btn-perspective" title="Toggle perspective / orthographic">Perspective</button>
      <button id="btn-reset" title="Reset camera">Reset</button>
      <button id="btn-top" title="Top-down view">Top</button>
      <button id="btn-front" title="Front view (door side)">Front</button>
      <button id="btn-side" title="Side view">Side</button>
    </div>
  </div>

  <!-- Content Area (spreadsheet + splitter + 3D canvas) -->
  <div id="content-area">
    <!-- Spreadsheet Panel -->
    <div id="spreadsheet-panel">
      <div class="spreadsheet-toolbar">
        <button id="btn-calculate" class="accent" title="Run solver with current spreadsheet data">Calculate</button>
        <button id="btn-import-csv" title="Import CSV file">Import CSV</button>
        <button id="btn-export-csv" title="Export spreadsheet as CSV">Export CSV</button>
        <button id="btn-template" title="Reset spreadsheet to template example data">Template</button>
        <div class="toolbar-spacer"></div>
        <span id="sheet-row-count" style="font-size:10px;color:var(--text-dim)"></span>
        <button id="btn-collapse-sheet" class="icon-btn" title="Collapse spreadsheet">&#9650;</button>
      </div>
      <div id="spreadsheet-container"></div>
      <input type="file" id="csv-file-input" accept=".csv,.txt,.tsv" style="display:none">
    </div>

    <!-- Splitter (drag to resize) -->
    <div id="splitter"></div>

    <!-- 3D Canvas -->
    <div id="canvas-wrap">
      <div id="tooltip"></div>
      <div id="ed-box-select"></div>
      <div id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Loading...</div>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <div id="sidebar">
    <!-- Department filter -->
    <div class="sidebar-section">
      <h3>Filter</h3>
      <select id="dept-filter" style="width:100%;background:var(--accent2);color:var(--text);border:1px solid var(--border);padding:5px 8px;border-radius:4px;font-size:12px">
        <option value="ALL">All Departments</option>
      </select>
    </div>

    <!-- Editor Panel (hidden when editor inactive) -->
    <div class="sidebar-section" id="editor-panel" style="display:none">
      <h3>Editor</h3>
      <div id="ed-info" style="font-size:11px;margin-bottom:8px"></div>
      <div id="ed-selection-info" style="font-size:11px;margin-bottom:8px;display:none"></div>
      <div style="display:flex;gap:4px;flex-wrap:wrap;margin-bottom:6px">
        <button class="footer-btn" id="ed-rotate" title="Rotate selected [R]">Rotate</button>
        <button class="footer-btn" id="ed-undo" title="Undo [Ctrl+Z]">Undo</button>
        <button class="footer-btn" id="ed-delete" title="Delete selected [Del]">Delete</button>
      </div>
      <div style="display:flex;gap:4px;margin-bottom:6px">
        <button class="footer-btn ed-lock-btn" id="ed-lock-x" title="Lock to X axis [X]">X</button>
        <button class="footer-btn ed-lock-btn" id="ed-lock-y" title="Lock to Y axis [Y]">Y</button>
        <button class="footer-btn ed-lock-btn" id="ed-lock-z" title="Lock to Z axis [Z]">Z</button>
        <span style="font-size:10px;color:var(--text-dim);align-self:center;margin-left:4px">Axis lock</span>
      </div>
      <div style="display:flex;gap:4px">
        <button class="footer-btn accent" id="ed-save">Save</button>
        <button class="footer-btn" id="ed-cancel">Cancel</button>
      </div>
    </div>

    <!-- Legend -->
    <div class="sidebar-section" id="legend-section">
      <h3>Department Legend</h3>
      <div id="legend-list"></div>
    </div>

    <!-- Detail Panel -->
    <div class="sidebar-section" id="detail-panel">
      <div class="detail-header">
        <h3 style="margin:0;padding:0;border:none">Case Details</h3>
        <button class="detail-close" id="detail-close">&times;</button>
      </div>
      <div id="detail-content"></div>
    </div>

    <!-- Case List -->
    <div class="sidebar-section" style="flex:1;display:flex;flex-direction:column;min-height:0">
      <h3>Cases (<span id="visible-count">0</span>)</h3>
      <div id="case-list"></div>
    </div>
  </div>

  <!-- Footer -->
  <div id="footer">
    <div class="stat">
      <span class="stat-label">Cases:</span>
      <span class="stat-value" id="stat-cases">0</span>
    </div>
    <div class="stat">
      <span class="stat-label">Walls:</span>
      <span class="stat-value" id="stat-walls">0</span>
    </div>
    <div class="stat">
      <span class="stat-label">Depth:</span>
      <span class="stat-value" id="stat-depth">0" / 624"</span>
    </div>
    <div class="stat">
      <span class="stat-label">Fill:</span>
      <div class="stat-bar"><div class="stat-bar-fill" id="stat-bar-fill" style="width:0%;background:var(--accent)"></div></div>
      <span class="stat-value" id="stat-fill">0%</span>
    </div>
    <div class="stat">
      <span class="stat-label">Volume:</span>
      <span class="stat-value" id="stat-volume">0%</span>
    </div>
    <span id="sheet-status"></span>
  </div>
</div>

<script type="module" src="js/app.js"></script>
</body>
</html>
